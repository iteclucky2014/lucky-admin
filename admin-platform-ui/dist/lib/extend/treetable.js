/** layuiAdmin.pro-v1.1.0 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(["form"],function(t){var i="treetable",e=layui.jquery,c=layui.form,a=function(){};a.prototype.cinfig=function(t){this.c=e.extend({elem:"#tree-table",field:"id",icon_class:"down",icon_val:{open:"&#xe623;",close:"&#xe625;"},space:4,new_data:[],childs:[],is_open:!1},t)},a.prototype.on=function(t,e){return layui.onevent.call(this,i,t,e)},a.prototype.template=function(t){var i=this,c=[],a="",n=i.c.is_checkbox?'<td><input type="checkbox" lay-skin="primary" lay-filter="lay-t"></td>':"";return e.each(i.c.cols,function(t,i){n+='<th style="width:'+i.width+'">'+i.title+"</th>"}),e.each(t,function(t,n){var d='class="'+(0==n.pid||n.pid==i.cache(n.pid)||i.c.is_open?"":"hide")+'"',o='<tr data-id="'+n.id+'" data-pid="'+n.pid+'" '+d+">"+(i.c.is_checkbox?'<td><div><input type="checkbox" lay-skin="primary" lay-filter="lay-t"></div></td>':"");c[n.id]=n.pid>0?c[n.pid]+1:0,e.each(i.c.cols,function(t,e){o+='<td style="width:'+e.width+'">',e.field==i.c.field&&(o+="&nbsp;".repeat(c[n.id]*i.c.space),i.c.childs[n.id]&&(o+='<i class="layui-icon '+i.c.icon_class+'">'+(n.id==i.cache(n.id)||i.c.is_open?i.c.icon_val.close:i.c.icon_val.open)+"</i>")),o+=(void 0!==n[e.field]?n[e.field]:e.template?e.template(n):"")+"</td>"}),a+=o+"</tr>"}),'<thead><tr data-id="0" data-pid="-1">'+n+"</tr></thead><tbody>"+a+"</tbody>"},a.prototype.render=function(t){var a=this,n=[];a.cinfig(t),e.each(a.c.data,function(t,i){a.c.childs[i.pid]||(a.c.childs[i.pid]=[]),a.c.childs[i.pid][i.id]=a.c.new_data[i.id]=n[i.id]=i});var d=this.tree(n,0,[],0),o=a.template(d);e(a.c.elem).html(o).on("click","td",function(){var t=e(this).parents("tr").data("id"),c=e(this).parents("tr").data("pid"),n=e(a.c.elem).find("tr[data-pid="+t+"]").is(":visible"),d=e(this).find("."+a.c.icon_class);d.length&&(n?(a.hide(t),d.html(a.c.icon_val.open)):(e(a.c.elem).find("tr[data-pid="+t+"]").removeClass("hide"),a.cache(t,!0),a.show(t),d.html(a.c.icon_val.close)));var o=e(this).parents("[lay-filter]").attr("lay-filter");return o?layui.event.call(this,i,i+"("+o+")",{elem:e(this),status:n,item:a.c.new_data[t],childs:a.c.childs[t],siblings:a.c.childs[c],index:e(this).index(),is_last:e(this).index()+1==e(this).parents("tr").find("td").length}):""}).on("click","td [lay-filter]",function(){var t=e(this).parents("tr").data("id"),c=e(this).attr("lay-filter");return layui.event.call(this,i,i+"("+c+")",{elem:e(this),item:a.c.new_data[t]})}),c.render("checkbox").on("checkbox(lay-t)",function(t){var i=e(t.othis).hasClass("layui-form-checked"),n=e(t.elem).parents("tr");a.child_to_choose(n.data("id"),i),a.parent_to_choose(n.data("pid")),c.render("checkbox")})},a.prototype.parent_to_choose=function(t){var i=this,c=e(i.c.elem).find("[data-pid="+t+"]"),a=c.find("[lay-skin=primary]:checked").length,n=e(i.c.elem).find("[data-id="+t+"] [lay-skin=primary]"),d=e(i.c.elem).find("[data-id="+t+"]").data("pid");c.length!=a&&0!=a||(n.prop("checked",c.length==a),d>-1&&i.parent_to_choose(d))},a.prototype.child_to_choose=function(t,i){var c=this;e(c.c.elem).find("tr[data-pid="+t+"]").each(function(){e(this).find("[lay-skin=primary]").prop("checked",i);var t=e(this).data("id");c.child_to_choose(t,i)})},a.prototype.hide=function(t){var i=this;e(i.c.elem).find("tr[data-pid="+t+"]").each(function(){e(this).addClass("hide"),e(this).find("."+i.c.icon_class).html(i.c.icon_val.open);var t=e(this).data("id");i.hide(t),e(this).hide()}),i.cache(t,!1)},a.prototype.show=function(t){var i=this;e(i.c.elem).find("tr[data-pid="+t+"]").each(function(){e(this).removeClass("hide"),e(this).find("."+i.c.icon_class).html(i.c.icon_val.close);var t=e(this).data("id");i.show(t),e(this).show()}),i.cache(t,!0)},a.prototype.tree=function(t,i,c){var a=this;return t[i]&&(c.push(t[i]),delete t[i]),e.each(a.c.data,function(e,n){n.pid==i&&c.concat(a.tree(t,n.id,c))}),c},a.prototype.cache=function(t,i){var c=this,a="tree-table-open-item",t=t.toString(),n=c.get_cookie(a)?c.get_cookie(a).split(","):[],d=e.inArray(t,n);return void 0===i?d!=-1&&t:(i&&d==-1&&n.push(t),!i&&d>-1&&n.splice(d,1),void c.set_cookie(a,n.join(",")))},a.prototype.set_cookie=function(t,i,e){var c=new Date;c.setTime(c.getTime()+24*(e?e:30)*60*60*1e3),document.cookie=t+"="+escape(i)+";expires="+c.toGMTString()},a.prototype.get_cookie=function(t){var i,e=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(i=document.cookie.match(e))?unescape(i[2]):null},a.prototype.all=function(t){var i=this;if("up"==t)e(i.c.elem).find("tr[data-pid=0]").each(function(){var t=e(this).data("id");i.hide(t),e(this).find("."+i.c.icon_class).html(i.c.icon_val.open)});else if("down"==t)e(i.c.elem).find("tr[data-pid=0]").each(function(){var t=e(this).data("id");i.show(t),e(this).find("."+i.c.icon_class).html(i.c.icon_val.close)});else if("checked"==t){var c=[],a=[];return e(i.c.elem).find("tbody [lay-skin=primary]:checked").each(function(){var t=e(this).parents("tr").data("id");a.push(i.c.new_data[t]),c.push(t)}),{ids:c,data:a}}};var a=new a;t(i,a)});