/** layuiAdmin.pro-v1.1.0 LPPL License By http://www.layui.com/admin/ */
 ;layui.define(["table","treetable","form"],function(e){var t=layui.$,a=layui.admin,i=layui.view,r=layui.table,n=(layui.treetable,layui.form),o=layui.data(layui.setter.tableName);r.render({elem:"#LAY-user-manage",url:"./json/useradmin/webuser.js",cols:[[{type:"checkbox",fixed:"left"},{field:"id",width:100,title:"ID",sort:!0},{field:"username",title:"用户名",minWidth:100},{field:"avatar",title:"头像",width:100,templet:"#imgTpl"},{field:"phone",title:"手机"},{field:"email",title:"邮箱"},{field:"sex",width:80,title:"性别"},{field:"ip",title:"IP"},{field:"jointime",title:"加入时间",sort:!0},{title:"操作",width:150,align:"center",fixed:"right",toolbar:"#table-useradmin-webuser"}]],page:!0,limit:30,height:"full-320",text:"对不起，加载出现异常！"}),r.on("tool(LAY-user-manage)",function(e){var t=e.data;"del"===e.event?layer.prompt({formType:1,title:"敏感操作，请验证口令"},function(t,a){layer.close(a),layer.confirm("真的删除行么",function(t){e.del(),layer.close(t)})}):"edit"===e.event&&a.popup({title:"编辑用户",area:["500px","450px"],id:"LAY-popup-user-add",success:function(e,a){i(this.id).render("user/user/userform",t).done(function(){n.render(null,"layuiadmin-form-useradmin"),n.on("submit(LAY-user-front-submit)",function(e){e.field;layui.table.reload("LAY-user-manage"),layer.close(a)})})}})}),r.render({elem:"#LAY-user-back-manage",url:"/platform/user/page?access_token="+o.access_token,cols:[[{type:"checkbox",fixed:"left"},{field:"id",width:80,title:"ID",sort:!0},{field:"username",title:"登录名",sort:!0},{field:"password",title:"密码"},{field:"realName",title:"姓名"},{field:"dept",title:"部门",templet:function(e){return e.dept?e.dept.deptName:""}},{field:"tel",title:"手机"},{field:"authorities",title:"拥有角色",templet:function(e){var t=e.authorities||[];return t.map(function(e){return e.roleName}).join(",")}},{title:"操作",width:150,align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],text:"对不起，加载出现异常！",page:!0}),r.on("tool(LAY-user-back-manage)",function(e){var s=e.data;"del"===e.event?layer.confirm("确定删除此用户吗？",function(e){var a=[];a.push(s.id);var i=layer.msg("处理中",{icon:16,shade:.01,time:0});t.ajax({url:"/platform/user/delete?access_token="+o.access_token,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userid:"10001",username:"admin",data:a}),dataType:"json",success:function(e){0===e.code?(layer.close(i),r.reload("LAY-user-back-manage"),layer.msg("已删除")):layer.msg(e.msg,{icon:6})},error:function(e){layer.msg(e.msg,{icon:6})}})}):"edit"===e.event&&t.getJSON("/platform/role/page?page=1&limit=100&access_token="+o.access_token,function(e){a.popup({title:"编辑管理员",area:["500px","600px"],id:"LAY-popup-user-add",success:function(a,r){i(this.id).render("user/administrators/adminform",s).done(function(){n.render(null,"layuiadmin-form-admin");var a=e.data||[];a.forEach(function(e){t("#LAY-popup-user-add-roles-checkbox").append('<input type="checkbox" name="platformRoles[]" title="'+e.roleName+'" value="'+e.id+'" lay-skin="primary">')});var i=[];s.authorities.forEach(function(e){i.push(e.id)}),t("#LAY-popup-user-add-roles-checkbox input").each(function(){t.inArray(parseInt(t(this).val()),i)!=-1?t(this).prop("checked",!0):t(this).prop("checked",!1)}),n.render("checkbox"),n.on("submit(LAY-user-back-submit)",function(e){var a=e.field,i=[];for(var n in a)n.indexOf("platformRoles[")!=-1&&i.push(a[n]);a.platformRoles=i;var s=layer.msg("处理中",{icon:16,shade:.01,time:0});t.ajax({url:"/platform/user/save?access_token="+o.access_token,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userid:"10001",username:"admin",data:a}),dataType:"json",success:function(e){0===e.code?(layer.close(s),layui.table.reload("LAY-user-back-manage"),layer.close(r)):layer.msg(e.msg,{icon:6})},error:function(e){layer.msg(e.msg,{icon:6})}})})})}})})}),r.render({elem:"#LAY-user-back-role",url:"/platform/role/page?page=1&limit=100&access_token="+o.access_token,cols:[[{type:"checkbox",fixed:"left"},{field:"role",title:"角色标识",sort:!0},{field:"roleName",title:"角色名称"},{field:"platformPermissions",title:"拥有权限",templet:function(e){var t=e.platformPermissions||[];return t.map(function(e){return e.name}).join(",")}},{field:"roleDesc",title:"权限描述"},{title:"操作",width:150,align:"center",fixed:"right",toolbar:"#table-useradmin-admin"}]],text:"对不起，加载出现异常！"}),r.on("tool(LAY-user-back-role)",function(e){var r=e.data;"del"===e.event?layer.confirm("确定删除此角色？",function(e){var a=[];a.push(r.id);var i=layer.msg("处理中",{icon:16,shade:.01});t.ajax({url:"/platform/role/delete?access_token="+o.access_token,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userid:"10001",username:"admin",data:a}),dataType:"json",success:function(t){0===t.code?(layer.close(i),layer.close(e),layer.msg("已删除"),layui.table.reload("LAY-user-back-role")):layer.msg(t.msg,{icon:6})},error:function(e){layer.msg(e.msg,{icon:6})}})}):"edit"===e.event&&t.getJSON("/platform/permission/page?page=1&limit=100&access_token="+o.access_token,function(e){a.popup({title:"编辑角色",area:["500px","480px"],id:"LAY-popup-user-edit",success:function(a,s){i(this.id).render("user/administrators/roleform",r).done(function(){n.render(null,"layuiadmin-form-role");var a=e.data||[];a.forEach(function(e){t("#LAY-popup-user-edit-platformPermissions-checkbox").append('<input type="checkbox" name="platformPermissions[]" title="'+e.name+'" value="'+e.id+'" lay-skin="primary">')});var i=[];r.platformPermissions.forEach(function(e){i.push(e.id)}),t("#LAY-popup-user-edit-platformPermissions-checkbox input[name^='platformPermissions']").each(function(){t.inArray(parseInt(t(this).val()),i)!=-1?t(this).prop("checked",!0):t(this).prop("checked",!1)}),n.render("checkbox"),n.on("submit(LAY-user-role-submit)",function(e){var a=e.field;console.log(JSON.stringify(a));var i=[];for(var r in a)r.indexOf("platformPermissions[")!=-1&&i.push(a[r]);a.platformPermissions=i;var n=layer.msg("处理中",{icon:16,shade:.01});t.ajax({url:"/platform/role/save?access_token="+o.access_token,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userid:"10001",username:"admin",data:a}),dataType:"json",success:function(e){0===e.code?(layer.close(n),layer.close(s),layui.table.reload("LAY-user-back-role")):layer.msg(e.msg,{icon:6})},error:function(e){layer.msg(e.msg,{icon:6})}})})})}})})}),e("useradmin",{})});